<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Part 1: Intro to Microcontrollers With Emulation</title>
  <link rel="stylesheet" href="https://moorepants.github.io/eme185/2019/theme/css/main.css" />
  <link rel="stylesheet" href="https://moorepants.github.io/eme185/2019/theme/css/custom.css" />

  <!--[if IE]>
      <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <script type="text/javascript"
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
</head>

<body id="index" class="home">
  <header id="banner" class="body">
    <h1><a href="https://moorepants.github.io/eme185/2019/">EME 185: Mechanical Systems Design Project </a></h1>
    <nav><ul>
        <li><a href="/eme185/2019">Syllabus</a></li>
        <li><a href="/eme185/2019/pages/schedule.html">Schedule</a></li>
        <li><a href="/eme185/2019/pages/assignments.html">Assignments</a></li>
        <li><a href="https://www.moorepants.info/jkm/courses/eme185-2019/pages/projects.html">Projects</a></li>
        <li><a href="/eme185/2019/pages/resources.html">Resources</a></li>
    </ul></nav>
  </header><!-- /#banner -->
<section id="content" class="body">
    <h1 class="entry-title">Part 1: Intro to Microcontrollers With Emulation</h1>
    
    <div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id12">Introduction</a></li>
<li><a class="reference internal" href="#objectives" id="id13">Objectives</a></li>
<li><a class="reference internal" href="#microcontrollers" id="id14">Microcontrollers</a></li>
<li><a class="reference internal" href="#emulation" id="id15">Emulation</a></li>
<li><a class="reference internal" href="#c-language" id="id16">C Language</a></li>
<li><a class="reference internal" href="#variables" id="id17">Variables</a><ul>
<li><a class="reference internal" href="#exercise" id="id18">Exercise</a></li>
</ul>
</li>
<li><a class="reference internal" href="#functions-setup-loop-and-custom" id="id19">Functions: setup(), loop(), and custom</a><ul>
<li><a class="reference internal" href="#id1" id="id20">Exercise</a></li>
<li><a class="reference internal" href="#id2" id="id21">Exercise</a></li>
</ul>
</li>
<li><a class="reference internal" href="#serial-communications" id="id22">Serial Communications</a><ul>
<li><a class="reference internal" href="#id3" id="id23">Exercise</a></li>
</ul>
</li>
<li><a class="reference internal" href="#digital-i-o" id="id24">Digital I/O</a><ul>
<li><a class="reference internal" href="#id6" id="id25">Exercise</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conditionals" id="id26">Conditionals</a><ul>
<li><a class="reference internal" href="#id9" id="id27">Exercise</a></li>
</ul>
</li>
<li><a class="reference internal" href="#loops" id="id28">Loops</a></li>
<li><a class="reference internal" href="#analog-read" id="id29">Analog Read</a><ul>
<li><a class="reference internal" href="#id10" id="id30">Exercise</a></li>
</ul>
</li>
<li><a class="reference internal" href="#arduino-ide" id="id31">Arduino IDE</a></li>
<li><a class="reference internal" href="#homework-assignment" id="id32">Homework Assignment</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="toc-backref headerlink" href="#id12">¶</a></h2>
<p>This lesson will introduce you to programming the Arduino microcontroller board
using an electronics emulator.</p>
</div>
<div class="section" id="objectives">
<h2>Objectives<a class="toc-backref headerlink" href="#id13">¶</a></h2>
<p>After the lesson students will be able to:</p>
<ul class="simple">
<li>explain what a microcontroller is and what it may be used for</li>
<li>use an emulator to program and simulate and Arduino</li>
<li>program an Arduino with basic C code</li>
</ul>
</div>
<div class="section" id="microcontrollers">
<h2>Microcontrollers<a class="toc-backref headerlink" href="#id14">¶</a></h2>
<p>Microcontrollers are very simple computers that have a central processing unit
(CPU), memory, and various electrical inputs and outputs. They allow us to
enhance electrical circuits with logic and algorithms. They are particularly
useful to engineers due to the ability to implement control systems for driving
electrically controlled actuators. They allow you write programs that can
execute in real time. The are typically used as &quot;embedded systems&quot;, i.e.  for
lightweight very specific use hardware enhancements.</p>
<p>Examples:</p>
<ul class="simple">
<li><a class="reference external" href="https://en.wikipedia.org/wiki/PIC_microcontroller">PIC</a> family of chipsets.</li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Atmel_AVR">AVR</a> family of chipsets.</li>
</ul>
<p>It is important to note the difference between computers and microcontrollers.
Computers may have multiple CPUs with many more inputs and outputs. They also
have more and varied memory. Computers can typically display to rich displays
and handle many standardized peripherals. Finally, a computer typically runs an
operating system that manages many processes at once and interfaces with
complex hardware. Operating systems typically do not execute their commands in
real time, but are queued.</p>
<p>Examples:</p>
<ul class="simple">
<li>Laptop</li>
<li>Smart phone</li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Raspberry_Pi">Raspberry Pi</a></li>
<li>Supercomputer</li>
</ul>
</div>
<div class="section" id="emulation">
<h2>Emulation<a class="toc-backref headerlink" href="#id15">¶</a></h2>
<p>In general, the code you write on your computer for the microcontroller must be
compiled, i.e.  transformed into the language of the Arduino's CPU, and then
uploaded onto the Arduino's memory. To try out code on the Arduino you must
have the actual hardware. But during this lesson we will make use of an Arduino
emulator which allows us to try out code we want to run on an Arduino without
having the actual hardware. There are a number of Arduino emulators available,
but we will make use of a web application called <a class="reference external" href="https://www.tinkercad.com/">TinkerCAD</a>.</p>
<ol class="arabic simple">
<li>Visit TinkerCAD and create an account.</li>
<li>Sign in to your account.</li>
<li>From your profile page, Select &quot;Circuits&quot; and &quot;Create new Circuit&quot;.</li>
</ol>
<dl class="docutils">
<dt>Components</dt>
<dd>Open a library of components that can be dropped onto the workspace.</dd>
<dt>Breadboard</dt>
<dd>The breadboard is a basic component that has a grid of pins inputs where
wires can be inserted. The rows along the top and bottom are connected
internally and generally used to supply a common voltage and ground. The
columns in the middle rows are connected together internally.</dd>
</dl>
<p>Search for Arduino Uno and drag it onto the screen.</p>
<p>The Arduino board has an MCU chip which is connected to the black pins along
the edges. There is an USB plug to connect to your computer for communication
purposes and can also be used to power the Arduino itself. Look at the pin
labels on the board.</p>
<dl class="docutils">
<dt>Ground</dt>
<dd>The common ground for the circuit (the negative polarity side of the
circuit).</dd>
<dt>5V</dt>
<dd>A 5V power supply which can provide up to 900 milli-amps of current
depending on the power source.</dd>
<dt>Digital I/O</dt>
<dd>Pins that can read binary inputs and write binary outputs.</dd>
<dt>Analog Inputs</dt>
<dd>Pins that can read continuous inputs and convert them to a digital signal.</dd>
<dt>Code button</dt>
<dd>Here you can edit the code that will be loaded onto any component that
excepts code, e.g. the Arduino UNO. Make sure to select &quot;Text&quot; instead of
blocks.</dd>
<dt>Serial monitor</dt>
<dd>This will display the outputs of the USB connection on the Arduino board.</dd>
<dt>Start Simulation</dt>
<dd>This will run the simulation of the circuit.</dd>
</dl>
</div>
<div class="section" id="c-language">
<h2>C Language<a class="toc-backref headerlink" href="#id16">¶</a></h2>
<p>The Arduino can be programmed by writing code in the C programming language. C
is a low level language that compiles directly to machine code for different
CPU architectures and is one of the most widely used programming languages.
Most work with microcontrollers is done in C.</p>
<p>Click on the 'Code' button and switch from 'Blocks' to the 'Text' editor in the
dropdown box. Now you can code directly in the C language instead of using
simplified code blocks.</p>
</div>
<div class="section" id="variables">
<h2>Variables<a class="toc-backref headerlink" href="#id17">¶</a></h2>
<p>Objectives:</p>
<ul class="simple">
<li>Explain how to declare and assign variables.</li>
<li>Introduce the integer and double precision variables.</li>
<li>Explain how to convert (cast) one type to another.</li>
</ul>
<p>If you want to use a variable you have to specify the type of the variable when
you declare it. In the following case, a variable that holds the number for the
pin that is connected to the onboard LED is declared:</p>
<div class="highlight"><pre><span></span><span class="kr">int</span> <span class="n">led</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>
</pre></div>
<p>Here the <tt class="docutils literal">int</tt> specifies this value to be a signed integer, i.e. any positive
or negative whole number. <tt class="docutils literal">led</tt> is the name of the variable and <tt class="docutils literal">13</tt> is the
value assigned to it. Finally, a <tt class="docutils literal">;</tt> is required to close the statement.</p>
<p>There are a number of other variable types: <tt class="docutils literal">double</tt>, <tt class="docutils literal">float</tt>, <tt class="docutils literal">bool</tt>,
<tt class="docutils literal">char</tt>, etc. For decimal values we will make use of a double precision
variable in this lesson. For example:</p>
<div class="highlight"><pre><span></span><span class="kr">double</span> <span class="n">measurement</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</pre></div>
<p>Lastly, you may need to cast variables of one type to another type. For example
you can convert an integer to a double with:</p>
<div class="highlight"><pre><span></span><span class="kr">int</span> <span class="n">int_val</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kr">double</span> <span class="n">double_val</span> <span class="o">=</span> <span class="p">(</span><span class="kr">double</span><span class="p">)</span> <span class="n">int_val</span><span class="p">;</span>
</pre></div>
<p>Note that the casting prefix only applies to the value directly adjacent to it.
This works:</p>
<div class="highlight"><pre><span></span><span class="kr">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kr">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
<span class="p">(</span><span class="kr">double</span><span class="p">)</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="kr">double</span><span class="p">)</span> <span class="n">b</span><span class="p">;</span>
</pre></div>
<p>But this does not:</p>
<div class="highlight"><pre><span></span><span class="kr">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kr">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
<span class="p">(</span><span class="kr">double</span><span class="p">)</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span>
</pre></div>
<div class="section" id="exercise">
<h3>Exercise<a class="toc-backref headerlink" href="#id18">¶</a></h3>
<p>What will the value and type of the variable <tt class="docutils literal">result</tt> be in the following
code?</p>
<div class="highlight"><pre><span></span><span class="kr">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kr">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="kr">double</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">2.4</span><span class="p">;</span>

<span class="o">?</span> <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="kr">int</span><span class="p">)</span> <span class="n">c</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="n">a</span><span class="p">;</span>
</pre></div>
<ol class="loweralpha simple">
<li>22.00 (a double)</li>
<li>20 (an integer)</li>
<li>22 (an integer)</li>
<li>20.00 (a double)</li>
<li>30 (an integer)</li>
<li>the program will error due to incompatible types</li>
</ol>
</div>
</div>
<div class="section" id="functions-setup-loop-and-custom">
<h2>Functions: setup(), loop(), and custom<a class="toc-backref headerlink" href="#id19">¶</a></h2>
<p>Objectives:</p>
<ul class="simple">
<li>Understand what a function is, how to write one, and how to use one.</li>
<li>Learn what the required <tt class="docutils literal">setup()</tt> and <tt class="docutils literal">loop()</tt> functions are.</li>
</ul>
<p>For the first program let's send values from the Arduino to the connected
computer using the Universal Serial Bus (USB). Before we can do this we need to
discuss the two main functions that are in every Arduino program. The first
function is the <cite>setup()</cite> function and you specify it like so:</p>
<div class="highlight"><pre><span></span><span class="kr">void</span> <span class="nb">setup</span><span class="p">()</span> <span class="p">{</span>

<span class="p">};</span>
</pre></div>
<p>The first word is <tt class="docutils literal">void</tt> and this specifies what type of variable the
<tt class="docutils literal">setup()</tt> function will return. In this case, the type <tt class="docutils literal">void</tt> means that
the setup function will not return anything, which is convention for this
function. Also convention, is the function name <tt class="docutils literal">setup</tt>, which tells the
Arduino that whatever is in this function must be run once before the Arduino
starts the main computation loop. This is typically used for setting the
initial states of pins or initializing various attached devices. The <tt class="docutils literal">()</tt>
parentheses typically hold the arguments to the function but as convention
<tt class="docutils literal">setup</tt> has no arguments. Finally the braces <tt class="docutils literal">{}</tt> bound the code that will
execute in that function.</p>
<p>The second function that must be in every Arduino program is called <tt class="docutils literal">loop</tt>.
This function executes once every clock cycle (at 16 MHz), or as fast as it
can, and contains the main code for your application. The function follows the
style of <tt class="docutils literal">setup</tt> and looks like:</p>
<div class="highlight"><pre><span></span><span class="kr">void</span> <span class="nb">loop</span><span class="p">()</span> <span class="p">{</span>

<span class="p">};</span>
</pre></div>
<p>You can also create your own custom functions. These functions typically take a
number of arguments (inputs) and return a single output. The following function
computes the average of three values:</p>
<div class="highlight"><pre><span></span> <span class="kr">double</span> <span class="nf">average</span><span class="p">(</span><span class="kr">double</span> <span class="n">first_val</span><span class="p">,</span> <span class="kr">double</span> <span class="n">second_val</span><span class="p">,</span> <span class="kr">double</span> <span class="n">third_val</span><span class="p">)</span> <span class="p">{</span>

   <span class="kr">double</span> <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">first_val</span> <span class="o">+</span> <span class="n">second_val</span> <span class="o">+</span> <span class="n">third_val</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span>

   <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
<p>Note that the type of the arguments must be declared in the call signature. The
function can be used as such:</p>
<div class="highlight"><pre><span></span><span class="kr">double</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kr">double</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="kr">double</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="n">average</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</pre></div>
<p>which will result in the value <tt class="docutils literal">2.0</tt>.</p>
<p>Note that variables declared inside functions will not be available to other
functions.</p>
<div class="section" id="id1">
<h3>Exercise<a class="toc-backref headerlink" href="#id20">¶</a></h3>
<p>What will the result of the following code be if the values returned by the
<tt class="docutils literal">square()</tt> function were displayed to the screen in the <tt class="docutils literal">loop()</tt> function?</p>
<div class="highlight"><pre><span></span><span class="kr">int</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="kr">int</span> <span class="nf">square</span><span class="p">(</span><span class="kr">int</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span><span class="p">;</span>
<span class="p">};</span>

<span class="kr">void</span> <span class="nb">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="n">square</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="p">};</span>

<span class="kr">void</span> <span class="nb">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">square</span><span class="p">(</span><span class="n">counter</span><span class="p">);</span>
  <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="section" id="id2">
<h3>Exercise<a class="toc-backref headerlink" href="#id21">¶</a></h3>
<p>What is wrong with the following code?</p>
<div class="highlight"><pre><span></span><span class="kr">void</span> <span class="nb">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">};</span>

<span class="kr">void</span> <span class="nb">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">a</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
<p>Since <tt class="docutils literal">a</tt> is declared inside the <tt class="docutils literal">setup()</tt> function it will not be
available in the <tt class="docutils literal">loop()</tt> function due to the scoping rules of the Processing
language. You can make <tt class="docutils literal">a</tt> available to the <tt class="docutils literal">setup()</tt> and <tt class="docutils literal">loop()</tt>
functions by declaring it globally, i.e. outside and above each function.</p>
</div>
</div>
<div class="section" id="serial-communications">
<h2>Serial Communications<a class="toc-backref headerlink" href="#id22">¶</a></h2>
<p>Objectives:</p>
<ul class="simple">
<li>To understand the serial communications available on an Arduino.</li>
<li>To learn to print the results of a calculation to the serial port.</li>
</ul>
<p>The Arduino is capable of communicating using serial communications and we can
send simple ASCII text to and from the Arduino. There are many builtin
functions that are predefined that can be used in an Arduino program. To
initialize a serial communication with the Arduino at a communication baud rate
of 9600 symbols per second you can call:</p>
<div class="highlight"><pre><span></span><span class="nf">Serial</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
</pre></div>
<p>This function is typically called in <tt class="docutils literal">setup()</tt>.</p>
<p>You can print ASCII values to the serial communication port with the
<tt class="docutils literal">print()</tt> and <tt class="docutils literal">println()</tt> functions, where the difference is that the
former doesn't print a newline character (<tt class="docutils literal">\n</tt>), and the latter appends the
newline character automatically. The following code will print the integer
values to the serial port:</p>
<div class="highlight"><pre><span></span><span class="kr">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
<span class="nf">Serial</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="nf">Serial</span><span class="p">.</span><span class="nf">println</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="nf">Serial</span><span class="p">.</span><span class="nf">println</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
<p>The result would be:</p>
<pre class="literal-block">
1515
15
</pre>
<p>Let's modify the above exercise code so that we can see if our guess about the
result of the code is correct. You will need to open the serial monitor while
this code simulates to see the results. After you modify the code, simulate it,
and open the serial monitor to see the display.</p>
<div class="section" id="id3">
<h3>Exercise<a class="toc-backref headerlink" href="#id23">¶</a></h3>
<p>Add some print statements to your code so that you can see the results of the
<tt class="docutils literal">square()</tt> function calls on the serial monitor.</p>
<p>Solution:</p>
<div class="highlight"><pre><span></span><span class="kr">int</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="kr">int</span> <span class="nf">square</span><span class="p">(</span><span class="kr">int</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">void</span> <span class="nb">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="nf">Serial</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
  <span class="kr">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="nf">Serial</span><span class="p">.</span><span class="nf">println</span><span class="p">(</span><span class="n">square</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>
<span class="p">};</span>

<span class="kr">void</span> <span class="nb">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="nf">Serial</span><span class="p">.</span><span class="nf">println</span><span class="p">(</span><span class="n">square</span><span class="p">(</span><span class="n">counter</span><span class="p">));</span>
  <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="digital-i-o">
<h2>Digital I/O<a class="toc-backref headerlink" href="#id24">¶</a></h2>
<p>The digital I/O pins on the board can be set to either input or output mode and
can be activated or deactivated as you see fit for your particular application.</p>
<p>Typically in <tt class="docutils literal">setup()</tt> you will set the mode of the particular pin to input
or output, for example:</p>
<div class="highlight"><pre><span></span><span class="kr">int</span> <span class="n">led_pin_num</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>

<span class="kr">void</span> <span class="nb">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="nf">pinMode</span><span class="p">(</span><span class="n">led_pin_num</span><span class="p">,</span> <span class="kr">OUTPUT</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
<p>In the above code, the builtin function <tt class="docutils literal">pinMode()</tt> is used to set mode of
pin number 13 to <tt class="docutils literal">OUTPUT</tt> which is a builtin predefined variable <a class="footnote-reference" href="#id5" id="id4">[1]</a>.</p>
<p>It turns out that pin #13 on the Arduino is wired in parallel to a small LED on
the board. So we can make this LED blink by utilizing the builtin
<tt class="docutils literal">digitalWrite()</tt> function. In addition, the builtin <tt class="docutils literal">delay()</tt> function can
be used to control the duration of the cycle.</p>
<div class="highlight"><pre><span></span><span class="kr">void</span> <span class="nb">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="nf">digitalWrite</span><span class="p">(</span><span class="n">led_pin_num</span><span class="p">,</span> <span class="kr">HIGH</span><span class="p">);</span>
  <span class="nf">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
  <span class="nf">digitalWrite</span><span class="p">(</span><span class="n">led_pin_num</span><span class="p">,</span> <span class="kr">LOW</span><span class="p">);</span>
  <span class="nf">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
<p><tt class="docutils literal">HIGH</tt> and <tt class="docutils literal">LOW</tt> are builtin global variables that cause the pins to create
maximum and minimum voltage, respectively.</p>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[1]</a></td><td>All caps are convention for global variables.</td></tr>
</tbody>
</table>
<div class="section" id="id6">
<h3>Exercise<a class="toc-backref headerlink" href="#id25">¶</a></h3>
<p>Plug in an LED to the breadboard and connect its anode (+, long side) to a 150
ohm resistor <a class="footnote-reference" href="#id8" id="id7">[2]</a>. Then connect the other end of the resistor to the number 13
pin.  Finally, connect the LED's cathode (-, short side) to the ground pin and
confirm that the LED component blinks the same as the on board LED.</p>
<p><a class="reference external" href="https://circuits.io/circuits/1573816-simple-led">Simple LED Solution</a></p>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[2]</a></td><td>The resistor ensures that the LED doesn't draw more current than the
Arduino board and the LED can handle.</td></tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="conditionals">
<h2>Conditionals<a class="toc-backref headerlink" href="#id26">¶</a></h2>
<p>C supports flow control with <tt class="docutils literal">if</tt> statements. For example, if you'd like to
activate the on-board LED every 100 milliseconds except on every 5th cycle wait
for 1000 milliseconds. You could use:</p>
<div class="highlight"><pre><span></span><span class="kr">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kr">void</span> <span class="nb">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="nf">pinMode</span><span class="p">(</span><span class="n">led_pin_num</span><span class="p">,</span> <span class="kr">OUTPUT</span><span class="p">);</span>
<span class="p">}</span>

<span class="kr">void</span> <span class="nb">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">digitalWrite</span><span class="p">(</span><span class="n">led_pin_num</span><span class="p">,</span> <span class="kr">HIGH</span><span class="p">);</span>
      <span class="nf">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
      <span class="nf">digitalWrite</span><span class="p">(</span><span class="n">led_pin_num</span><span class="p">,</span> <span class="kr">LOW</span><span class="p">);</span>
      <span class="nf">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nf">digitalWrite</span><span class="p">(</span><span class="n">led_pin_num</span><span class="p">,</span> <span class="kr">HIGH</span><span class="p">);</span>
      <span class="nf">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
      <span class="nf">digitalWrite</span><span class="p">(</span><span class="n">led_pin_num</span><span class="p">,</span> <span class="kr">LOW</span><span class="p">);</span>
      <span class="nf">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>The <tt class="docutils literal">%</tt> operator computes the modulus (remainder after division).</p>
<div class="section" id="id9">
<h3>Exercise<a class="toc-backref headerlink" href="#id27">¶</a></h3>
<p>What does the following code do?</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nf">digitalRead</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="o">==</span> <span class="kr">HIGH</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">digitalWrite</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="kr">HIGH</span><span class="p">);</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="nf">digitalWrite</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="kr">LOW</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="loops">
<h2>Loops<a class="toc-backref headerlink" href="#id28">¶</a></h2>
<p>There are two types of loops available for use <tt class="docutils literal">for</tt> and <tt class="docutils literal">while</tt> loops. To
do something a specific number of times you can use a for loop. For example,
this loop will execute ten times, i.e. i = 0, 1, 2, ..., 9.</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="kr">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

  <span class="kr">int</span> <span class="n">milliseconds</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
  <span class="nf">digitalWrite</span><span class="p">(</span><span class="n">led_pin_num</span><span class="p">,</span> <span class="kr">HIGH</span><span class="p">);</span>
  <span class="nf">delay</span><span class="p">(</span><span class="n">milliseconds</span><span class="p">);</span>
  <span class="nf">digitalWrite</span><span class="p">(</span><span class="n">led_pin_num</span><span class="p">,</span> <span class="kr">LOW</span><span class="p">);</span>
  <span class="nf">delay</span><span class="p">(</span><span class="n">milliseconds</span><span class="p">);</span>

<span class="p">}</span>

<span class="nf">delay</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="analog-read">
<h2>Analog Read<a class="toc-backref headerlink" href="#id29">¶</a></h2>
<p>There are six analog input pins on the Arduino Uno. Sources that supply
continuous voltage from 0 to 5 volts can be read using these pins. For example,
it is useful for reading the voltage from a potentiometer. To read the voltage
from pin <tt class="docutils literal">A0</tt> you call:</p>
<div class="highlight"><pre><span></span><span class="kr">int</span> <span class="n">pin_num</span> <span class="o">=</span> <span class="n">A0</span><span class="p">;</span>

<span class="kr">int</span> <span class="n">val</span> <span class="o">=</span> <span class="nf">analogRead</span><span class="p">(</span><span class="n">pin_num</span><span class="p">);</span>
</pre></div>
<p>Note that this returns an integer. The on-board analog to digital converter has
10 bit resolution, i.e. 2^10 = 1024 possible readings. The values 0 to 1023 are
mapped to 0 to 5 volts, i.e. .0049 volts per step. You will need a conversion
factor to convert the value from an integer to a voltage value of double
precision.</p>
<div class="section" id="id10">
<h3>Exercise<a class="toc-backref headerlink" href="#id30">¶</a></h3>
<p>Drop in a power supply component and connect the black pin to the Arduino's
ground and the red pin to the <tt class="docutils literal">A0</tt> pin. Write some code that causes the
voltage to display to the serial monitor and ensure that it matches the voltage
supplied by the power supply.</p>
<p><a class="reference external" href="https://circuits.io/circuits/1588003-simple-analog-read">Analog Read Solution</a></p>
</div>
</div>
<div class="section" id="arduino-ide">
<h2>Arduino IDE<a class="toc-backref headerlink" href="#id31">¶</a></h2>
<p>To work with the real Arduino hardware you will use the Arduino integrated
development environment (IDE). The &quot;verify&quot; button compiles your code and
reports any errors you may have. The &quot;upload&quot; button will send the program to
the Arudino for execution.</p>
<p><a class="reference external" href="https://www.arduino.cc/en/Main/Software">Arduino IDE</a></p>
</div>
<div class="section" id="homework-assignment">
<h2>Homework Assignment<a class="toc-backref headerlink" href="#id32">¶</a></h2>
<p>The goal of the homework assignment is to create a fuel level indicator using a
row of 10 LEDS. The sensor for the fuel level should be a simple potentiometer.
It is connected to a floating bob in the fuel tank and the potentiometer
rotates as the fuel level increases and decreases. The potentiometer voltage 0
to 5 volts maps to a rotation of 270 degrees (the simple potentiometer
component on circuits.io). If all of the LEDs are on, that signals that the
fuel level is at a maximum and if all of the LEDs are off that signals that the
fuel tank is empty. If some LEDs are on, the number of lights should correspond
linearly to the fuel level. The following diagram shows the physical system.
Your job is to create the electronic side.</p>
<object class="align-center" data="https://moorepants.github.io/eme185/2019/images/fuel-meter.svg" style="width: 600px;" type="image/svg+xml">
</object>
</div>
</section>
  <section id="extras" class="body">
  </section><!-- /#extras -->
  <footer id="contentinfo" class="body">
    <address id="about" class="vcard body">
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
      <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
    </a>
    <br />
    This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
    <br />
    <br />
    Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
    <p>The source for the website is <a
        href="https://github.com/moorepants/eme185">hosted on
        Github</a>. Report issues
      and make contributions there.</p>
    </address><!-- /#about -->
  </footer><!-- /#contentinfo -->

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-15966419-8', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>